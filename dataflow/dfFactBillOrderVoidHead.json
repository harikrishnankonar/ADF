{
	"name": "dfFactBillOrderVoidHead",
	"properties": {
		"folder": {
			"name": "POS Transaction"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "dsdwsourcedb",
						"type": "DatasetReference"
					},
					"name": "dfFactBillOrderVoidHead"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "FactBillOrderVoidHead",
						"type": "DatasetReference"
					},
					"name": "FactBillOrderVoidHead"
				}
			],
			"transformations": [],
			"script": "source(output(\n\t\tBillOrderVoidHeadID as integer,\n\t\tPOSID as integer,\n\t\tPropertyID as integer,\n\t\tRegionID as integer,\n\t\tBrandID as integer,\n\t\tCountryID as integer,\n\t\tBillDateID as integer,\n\t\tSettleDateID as integer,\n\t\tBillNo as string,\n\t\tBillAmount as decimal(38,8),\n\t\tBillTime as string,\n\t\tSettleTime as string,\n\t\tPax as integer,\n\t\tTableID as integer,\n\t\tKOTTypeID as integer,\n\t\tEmployeeID as integer,\n\t\tDessertsItemSold as boolean,\n\t\tTeaItemSold as boolean,\n\t\tDimsumItemSold as boolean,\n\t\tTotalTax as decimal(38,8),\n\t\tTotalDiscount as decimal(38,8),\n\t\tRoundOffAmount as decimal(38,8),\n\t\tComplimentory as decimal(38,8),\n\t\tTotalTipAmount as decimal(38,8),\n\t\tGroupSizeID as integer,\n\t\tCashID as integer,\n\t\tCreditCardID as integer,\n\t\tComplimentID as integer,\n\t\tNetAmount as decimal(38,8),\n\t\tSettlementHourID as integer,\n\t\tAvgPerCover as decimal(38,8),\n\t\tAvgPerCover01 as decimal(38,8),\n\t\tTableTurnAroundDuration as integer,\n\t\tBillMadeSettleDuration as integer,\n\t\tBillID as integer,\n\t\tMealID as integer,\n\t\tDimStyleofOperationID as integer,\n\t\tDimDiscCardID as integer,\n\t\tAdditionalCharge as decimal(18,8),\n\t\tUserID as integer,\n\t\tVoidUserID as integer,\n\t\tVoidReasonID as integer,\n\t\tWaiterID as integer,\n\t\tBillKOTTypeId as integer,\n\t\tBillMade_POSShiftId as integer,\n\t\tVoidBillKotID as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select isnull(t1.BillOrderVoidHeadID,0) BillOrderVoidHeadID,\\nisnull(t2.POSID,0) POSID,\\nisnull(t3.PropertyID,0) PropertyID,\\nisnull(t4.RegionID,0) RegionID,\\nisnull(t5.BrandID,0) BrandID,\\nisnull(t6.CountryID,0) CountryID,\\nisnull(t7.DateTimeID,0) BillDateID,\\nisnull(t8.DateTimeID,0) SettleDateID,\\nt1.BillNo,\\nisnull(t1.BillAmount,0) BillAmount,\\nt1.BillTime,\\nt1.SettleTime,\\nisnull(t1.Pax,0) Pax,\\nisnull(t9.TableID,0) TableID,\\nisnull(t10.KOTTypeID,0) KOTTypeID,\\nisnull(t11.EmployeeID,0) EmployeeID,\\nisnull(t12.DessertsItemSold,0) DessertsItemSold,\\nisnull(t12.TeaItemSold,0) TeaItemSold,\\nisnull(t12.DimsumItemSold,0) DimsumItemSold,\\nisnull(t1.TotalTax,0) TotalTax,\\nisnull(t1.TotalDiscount,0) TotalDiscount,\\nisnull(t1.RoundOffAmount,0) RoundOffAmount,\\nisnull(t1.Complimentory,0) Complimentory,\\nisnull(t1.TotalTipAmount,0) TotalTipAmount,\\nCase \\n\twhen t1.Pax >= 1 and t1.Pax <= 2 then 1\\n\twhen t1.Pax >= 3 and t1.Pax <= 4 then 2\\n\twhen t1.Pax >= 5 and t1.Pax <= 9 then 3\\n\twhen t1.Pax >= 10 and t1.Pax <= 100 then 4\telse 0 End as GroupSizeID,\\nisnull(t13.CashID,0) CashID,\\nisnull(t14.CreditCardID,0) CreditCardID,\\nCase When t1.PayCompliment = 1 then 1 else 0 end as ComplimentID,\\nt1.BillAmount+t1.RoundOffAmount-t1.TotalTax NetAmount,\\nDatePart(HH, isnull(T1.SettleTime,\\'12:00:00\\'))+1 SettlementHourID,\\ncase when t1.pax is null or t1.pax = 0\\n\tthen (t1.BillAmount+t1.RoundOffAmount-t1.TotalTax) else (t1.BillAmount+t1.RoundOffAmount-t1.TotalTax)/t1.Pax end as AvgPerCover,\\ncase when t1.Pax is null or t1.pax = 0 \\n\tthen (t1.BillAmount+t1.RoundOffAmount-t1.TotalTax) else (t1.BillAmount+t1.RoundOffAmount-t1.TotalTax)/t1.Pax end as AvgPerCover01,\\n0 as TableTurnAroundDuration,\\n0 as BillMadeSettleDuration,\\nisnull(t15.DimBillNoID,0) as BillID,\\nCase when datepart(HOUR,t1.SettleTime) >= 5 and  datepart(HOUR,t1.SettleTime) <= 11 then 1 \\n\t when datepart(HOUR,t1.SettleTime) >= 12 and datepart(HOUR,t1.SettleTime) <= 14 then 2 \\n\t when datepart(HOUR,t1.SettleTime) >= 15 and datepart(HOUR,t1.SettleTime) <= 18 then 3\\n\t when datepart(HOUR,t1.SettleTime) >= 19 and datepart(HOUR,t1.SettleTime) <= 24 then 4\\n\t when datepart(HOUR,t1.SettleTime) >= 0 and datepart(HOUR,t1.SettleTime) <= 4 then 4\\n\t else 0\\n\t end as MealID,\\nISNULL(t16.DimStyleofOperationID, 0) AS DimStyleofOperationID ,\\nIsNull(T17.DimDiscCardID,0) AS DimDiscCardID,\\nt1.AdditionalCharge,\\nisnull(t18.UserID,0) UserID,\\nisnull(t21.EmployeeID,0) VoidUserID,\\nisnull(t20.VoidReasonID,0) VoidReasonID\\n,ISNULL(T22.WaiterID,0) As WaiterID\\n,IsNull(T23.BillKOTTypeId,0) AS BillKOTTypeId\\n,ISNULL(T1.BillMadeShift,0) as BillMade_POSShiftId\\n, IsNull(T25.VoidBillKotID,0) as VoidBillKotID\\nFrom DimBillOrderVoidHead t1 with(nolock)\\nleft outer join DimPosMst t2  with(nolock) on t1.POSCode = t2.POSCode\\nleft outer join DimPropertyMst t3  with(nolock) on t1.PropertyCode = t3.PropertyCode\\nleft outer join DimRegionMst t4  with(nolock) on t1.RegionCode = t4.RegionCode\\nleft outer join DimBrandMst t5  with(nolock) on t1.BrandCode = t5.BrandCode \\nleft outer join DimCountryMst t6  with(nolock) on t1.CountryCode = t6.CountryCode\\nleft outer join DimDateTime t7  with(nolock) on t1.BillDateTime = t7.CDate\\nleft outer join DimDateTime t8  with(nolock) on t1.SettleDate = t8.CDate\\nleft outer join DimTableMst t9  with(nolock) on t1.TableRoomCode = t9.TableCode\\nleft outer join DimKOTTypes t10  with(nolock) on t1.KOTType =  t10.KOTTypeCode\\nleft outer join DimEmployeeMst t11  with(nolock) on t1.EmployeeCode = t11.EmployeeCode\\nleft outer join DimBillOrderOthers t12  with(nolock) on t1.POSCode = t12.poscode and t1.BillNo = t12.BillNo\\nleft outer join DimCash t13 with(nolock) on t1.paycash = t13.CashCode\\nleft outer join DimCreditCard t14 with(nolock) on t1.payCreditCard = t14.CreditCardCode\\nleft outer join DimBillNo t15 with(nolock) on t1.POSCode = t15.PosCode and t1.BillNo = t15.BillNo and t1.BillDateTime =  t15.BillDate\\nLEFT OUTER JOIN dbo.DimStyleOfOperation AS t16 WITH (nolock) ON t1.OrderFrom = t16.OrderFrom\\nleft outer join DimDiscCardMst t17 with(nolock) on t1.DiscCardCode = t17.DiscCardCode and t1.DiscCardDetailsCode = t17.DiscCardDetailsCode\\nleft outer join DimUser t18 with(nolock) on t1.billVoidby = t18.UserShortName\\nleft outer join DimVoidReasonMst t20 with(nolock) on t1.VoidReasonCode = t20.VoidReasonCode\\nleft outer join DimEmployeeMst t21  with(nolock) on t21.EmployeeCode = t18.EmployeeCode\\nLeft Outer Join DimWaiterMst T22 on T1.WaiterCode = T22.EmployeeCode and T1.PosCode = T22.PosCode\\nLeft Outer Join DimBillKOTType T23 on ltrim(Rtrim(T1.BillOrder)) = T23.BillKOTType\\nLeft Outer Join DimViodBillKot T25 on T1.PosCode = T25.PosCode and T1.BillNo = T25.BillNo',\n\tformat: 'query') ~> dfFactBillOrderVoidHead\ndfFactBillOrderVoidHead sink(input(\n\t\tFactBOHVoidID as integer,\n\t\tBillOrderHeadVoidID as integer,\n\t\tPOSID as integer,\n\t\tPropertyID as integer,\n\t\tRegionID as integer,\n\t\tBrandID as integer,\n\t\tCountryID as integer,\n\t\tBillDateID as integer,\n\t\tSettleDateID as integer,\n\t\tGroupSizeID as integer,\n\t\tBillNo as string,\n\t\tBillAmount as decimal(38,8),\n\t\tBillTime as string,\n\t\tSettleTime as string,\n\t\tPax as integer,\n\t\tTableID as integer,\n\t\tKOTTypeID as integer,\n\t\tDessertsItemSold as boolean,\n\t\tTeaItemSold as boolean,\n\t\tDimsumItemSold as boolean,\n\t\tEmployeeID as integer,\n\t\tTotalTax as decimal(38,8),\n\t\tTotalDiscount as decimal(38,8),\n\t\tRoundOffAmount as decimal(38,8),\n\t\tComplimentory as decimal(38,8),\n\t\tComplimentoryType as integer,\n\t\tTotalTipAmount as decimal(38,8),\n\t\tCashID as integer,\n\t\tCreditCardID as integer,\n\t\tTableTurnAroundDuration as integer,\n\t\tBillMadeSettleDuration as integer,\n\t\tPayCompliment as integer,\n\t\tComplimentID as integer,\n\t\tNetAmount as decimal(38,8),\n\t\tAvgPerCover as decimal(38,8),\n\t\tAvgPerCover01 as decimal(38,8),\n\t\tSettlementHourID as integer,\n\t\tBillID as integer,\n\t\tMealId as integer,\n\t\tDimStyleofOperationID as integer,\n\t\tDimDiscCardID as integer,\n\t\tAdditionalCharge as decimal(18,8),\n\t\tUserID as integer,\n\t\tVoidReasonID as integer,\n\t\tVoidUserID as integer,\n\t\tWaiterId as integer,\n\t\tBillKOTTypeId as integer,\n\t\tBillMade_POSShiftId as integer,\n\t\tVoidBillKotID as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tBillOrderHeadVoidID = BillOrderVoidHeadID,\n\t\tPOSID,\n\t\tPropertyID,\n\t\tRegionID,\n\t\tBrandID,\n\t\tCountryID,\n\t\tBillDateID,\n\t\tSettleDateID,\n\t\tGroupSizeID,\n\t\tBillNo,\n\t\tBillAmount,\n\t\tBillTime,\n\t\tSettleTime,\n\t\tPax,\n\t\tTableID,\n\t\tKOTTypeID,\n\t\tDessertsItemSold,\n\t\tTeaItemSold,\n\t\tDimsumItemSold,\n\t\tEmployeeID,\n\t\tTotalTax,\n\t\tTotalDiscount,\n\t\tRoundOffAmount,\n\t\tComplimentory,\n\t\tTotalTipAmount,\n\t\tCashID,\n\t\tCreditCardID,\n\t\tTableTurnAroundDuration,\n\t\tBillMadeSettleDuration,\n\t\tComplimentID,\n\t\tNetAmount,\n\t\tAvgPerCover,\n\t\tAvgPerCover01,\n\t\tSettlementHourID,\n\t\tBillID,\n\t\tMealId = MealID,\n\t\tDimStyleofOperationID,\n\t\tDimDiscCardID,\n\t\tAdditionalCharge,\n\t\tUserID,\n\t\tVoidReasonID,\n\t\tVoidUserID,\n\t\tWaiterId = WaiterID,\n\t\tBillKOTTypeId,\n\t\tBillMade_POSShiftId,\n\t\tVoidBillKotID\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> FactBillOrderVoidHead"
		}
	}
}