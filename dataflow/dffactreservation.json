{
	"name": "dffactreservation",
	"properties": {
		"folder": {
			"name": "BOT Master"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "dsdwsourcedb",
						"type": "DatasetReference"
					},
					"name": "dsfactreservation"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "FactReservation_Dest",
						"type": "DatasetReference"
					},
					"name": "FactReservation"
				}
			],
			"transformations": [],
			"script": "source(output(\n\t\tDimReservationID as integer,\n\t\tPOSID as integer,\n\t\tDimFloorID as integer,\n\t\tGuestID as integer,\n\t\tDimBookerID as integer,\n\t\tDimMealStructureId as integer,\n\t\tDateTimeID as integer,\n\t\tPax as integer,\n\t\tVisitsCount as integer,\n\t\tDimEventID as integer,\n\t\tDimFlagID as integer,\n\t\tActualPax as integer,\n\t\tDimStatusID as integer,\n\t\tResvCancelID as integer,\n\t\tDimReasonID as integer,\n\t\tWalkInID as integer,\n\t\tLastVisitedId as integer,\n\t\tDaysNotVisitedID as integer,\n\t\tVisitStatusID as integer,\n\t\tGuestRatingID as integer,\n\t\tReservationHourID as integer,\n\t\tGroupSizeId as integer,\n\t\tNoShowID as integer,\n\t\tBillAmount as decimal(18,9),\n\t\tCompBillAmount as decimal(18,8),\n\t\tBillCount as integer,\n\t\tNewCoustomerCount as integer,\n\t\tDimBookingSourceID as integer,\n\t\tDimBOTBillNoId as integer,\n\t\tCreatedById as integer,\n\t\tCreatedOnId as integer,\n\t\tCancelledDateId as integer,\n\t\tCancelledById as integer,\n\t\tBillDateId as integer,\n\t\tDaysInAdvance as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'Select t1.DimReservationID,\\n\tisnull(t2.POSID,0) as POSID, \\n\tisnull(t3.DimFloorId,0) as DimFloorID,\\n\tisnull(t4.GuestID,0) as GuestID,\\n\tisnull(t5.DimBookerID,0) as DimBookerID,\\n\tisnull(t6.DimMealStructureId,0) as DimMealStructureId,\\n\tisnull(t7.DateTimeID,0) as DateTimeID , \\n\tisnull(t1.Pax,0) as Pax,\\n\t1 as VisitsCount,\\n\tisnull(t8.DimEventID,0) as DimEventID,\\n\tisnull(t9.DimFlagId,0) as DimFlagID,\\n\tIsNull(t1.ActualPax,0) as ActualPax,\\n\tisnull(t10.DimStatusID,0) as DimStatusID,\\n\tisnull(t12.ResvCancelID,0) as ResvCancelID,\\n\tisnull(t11.DimReasonID,0) as DimReasonID,\\n\tisnull(t13.WalkInID,0) as WalkInID,\\n    isnull(t14.LastVisitedId,0) as LastVisitedId,\\n\tCase \\n\twhen t14.DaysNotVisited >= 31 and t14.DaysNotVisited <= 60 then 1\\n\twhen t14.DaysNotVisited >= 61 and t14.DaysNotVisited <= 90 then 2\\n\twhen t14.DaysNotVisited >= 91 and t14.DaysNotVisited <= 120 then 3\\n\twhen t14.DaysNotVisited >= 121 and t14.DaysNotVisited <= 150 then 4\\n\twhen t14.DaysNotVisited >= 151 and t14.DaysNotVisited <= 180 then 5\\n\twhen t14.DaysNotVisited >= 181 and t14.DaysNotVisited <= 270 then 6\\n\twhen t14.DaysNotVisited >= 271 and t14.DaysNotVisited <= 365 then 7\\n\twhen t14.DaysNotVisited >= 366 then 8\\n\telse 0 \\n\tEnd as DaysNotVisitedID,\\n\tCase \\n\twhen t14.VisitCount >= 1 and t14.VisitCount <= 1 then 1\\n\twhen t14.VisitCount >= 2 and t14.VisitCount <= 9 then 2\\n\twhen t14.VisitCount >= 10 and t14.VisitCount <= 50 then 3\\n\twhen t14.VisitCount >= 51 then 4\\n\telse 0 \\n\tEnd as VisitStatusID,\\n\tisnull(t15.GuestRatingID,0) as GuestRatingID,\\n\tCase \\n\twhen t1.FromTime >= 0.0 and t1.FromTime <= 1.0 then 1\\n\twhen t1.FromTime >= 1.0 and t1.FromTime <= 2.0 then 2\\n\twhen t1.FromTime >= 2.0 and t1.FromTime <= 3.0 then 3\\n\twhen t1.FromTime >= 3.0 and t1.FromTime <= 4.0 then 4\\n\twhen t1.FromTime >= 4.0 and t1.FromTime <= 5.0 then 5\\n\twhen t1.FromTime >= 5.0 and t1.FromTime <= 6.0 then 6\\n\twhen t1.FromTime >= 6.0 and t1.FromTime <= 7.0 then 7\\n\twhen t1.FromTime >= 7.0 and t1.FromTime <= 8.0 then 8\\n\twhen t1.FromTime >= 8.0 and t1.FromTime <= 9.0 then 9\\n\twhen t1.FromTime >= 9.0 and t1.FromTime <= 10.0 then 10\\n\twhen t1.FromTime >= 10.0 and t1.FromTime <= 11.0 then 11\\n\twhen t1.FromTime >= 11.0 and t1.FromTime <= 12.0 then 12\\n\twhen t1.FromTime >= 12.0 and t1.FromTime <= 13.0 then 13\\n\twhen t1.FromTime >= 13.0 and t1.FromTime <= 14.0 then 14\\n\twhen t1.FromTime >= 14.0 and t1.FromTime <= 15.0 then 15\\n\twhen t1.FromTime >= 15.0 and t1.FromTime <= 16.0 then 16\\n\twhen t1.FromTime >= 16.0 and t1.FromTime <= 17.0 then 17\\n\twhen t1.FromTime >= 17.0 and t1.FromTime <= 18.0 then 18\\n\twhen t1.FromTime >= 18.0 and t1.FromTime <= 19.0 then 19\\n\twhen t1.FromTime >= 19.0 and t1.FromTime <= 20.0 then 20\\n\twhen t1.FromTime >= 20.0 and t1.FromTime <= 21.0 then 21\\n\twhen t1.FromTime >= 21.0 and t1.FromTime <= 22.0 then 22\\n\twhen t1.FromTime >= 22.0 and t1.FromTime <= 23.0 then 23\\n\twhen t1.FromTime >= 23.0 and t1.FromTime <= 24.0 then 24\\n\telse 0 \\n\tEnd as ReservationHourID,\\n\tCase \\n\twhen t1.Pax >= 1 and t1.Pax <= 2 then 1\\n\twhen t1.Pax >= 3 and t1.Pax <= 4 then 2\\n\twhen t1.Pax >= 5 and t1.Pax <= 9 then 3\\n\twhen t1.Pax >= 10 then 4\\n\telse 0 \\n\tEnd as GroupSizeId,\\n\tCase \\n\twhen t1.status = 6 then 1\\n\telse 0 \\n\tEnd as NoShowID,\\n\tt1.BillAmount,\\n\tt1.CompBillAmount,\\n    Case \\n        when t1.BillAmount > 0 then 1\\n    else 0\\n    End as BillCount,\\n    0 as NewCoustomerCount,\\n\tisnull(t16.DimBookingSourceID,0) as DimBookingSourceID,\\n\t0 as DimBOTBillNoId,\\n\tIsNull(t20.BOTUserId,0) as CreatedById,\\n\tIsNull(t19.DateTimeID,0) as CreatedOnId,\\n\tIsNull(t17.DateTimeID,0) as CancelledDateId,\\n\tIsNull(t18.BOTUserId,0) as CancelledById,\\n\tIsNull(t21.DateTimeID,0) as BillDateId,\\n\tIsNull(T1.DaysInAdvance,0) as DaysInAdvance\\nFrom DimReservation t1\\nleft outer join DimPosMst t2 on t1.RestaurantId = t2.RestaurantID and t1.RestaurantId <>0\\nleft outer join Dimfloor t3 on t1.FloorId = t3.FloorID\\nleft outer join DimGuest t4 on t1.GuestId = t4.CustomerCode\\nleft outer join DimBooker t5 on t1.BookerId = t5.BookerID\\nleft outer join DimMealStructure t6 on t1.MealStructureId = t6.MealStructureID and t1.RestaurantId = t6.restaurantid\\nleft outer join DimDateTime t7 on t1.reserveddate = t7.Cdate\\nleft outer join dimevent t8 on t1.OccassionId = t8.eventId\\nleft outer join DimFlag t9 on t1.FlagId = t9.FlagID\\nleft outer join DimStatus t10 on t1.Status = t10.StatusID\\nleft outer join DimReason t11 on t1.Reason = t11.ReasonID\\nleft outer join DimResvCancel t12 on t1.IsCancelled = t12.ResvCancelCode\\nleft outer join DimWalkIns t13 on t1.IsWalkin = t13.WalkInCode\\nleft outer join DimLastVisited t14 on t1.guestid = t14.guestid\\nleft outer join DimGuestRating t15 on t4.RatingID = t15.RatingCode\\nleft outer join DimBookingSource t16 on t1.BookingSourceID = t16.BookingSourceID\\nleft outer join DimDateTime t17 on Cast(t1.CancelledDateTime as Date)  = t17.Cdate\\nleft outer join DimBotUser t18 on t1.CancelledBy = T18.UserId\\nleft outer join DimDateTime t19 on Cast(t1.CreatedOn as Date) = t19.Cdate\\nleft outer join DimBotUser t20 on t1.CreatedBy = t20.UserId\\nleft outer join DimDateTime t21 on Cast(t1.BillDAteTime as Date) = t21.Cdate',\n\tformat: 'query') ~> dsfactreservation\ndsfactreservation sink(input(\n\t\tFactReservationID as integer,\n\t\tDimReservationId as integer,\n\t\tPOSId as integer,\n\t\tDimFloorId as integer,\n\t\tGuestId as integer,\n\t\tDimBookerId as integer,\n\t\tDimMealStructureId as integer,\n\t\tDatetimeID as integer,\n\t\tPax as integer,\n\t\tVisitsCount as integer,\n\t\tDimEventID as integer,\n\t\tDimFlagId as integer,\n\t\tActualPax as integer,\n\t\tDimStatusID as integer,\n\t\tResvCancelID as integer,\n\t\tDimReasonID as integer,\n\t\tWalkinID as integer,\n\t\tLastVisitedID as integer,\n\t\tDaysNotVisitedID as integer,\n\t\tVisitStatusID as integer,\n\t\tGuestRatingID as integer,\n\t\tReservationHourID as integer,\n\t\tGroupSizeId as integer,\n\t\tNoShowId as integer,\n\t\tBillAmount as decimal(18,9),\n\t\tCompBillAmount as decimal(18,9),\n\t\tBillCount as integer,\n\t\tNewCoustomerCount as integer,\n\t\tDimBookingSourceId as integer,\n\t\tDimBOTBillNoID as integer,\n\t\tCreatedById as integer,\n\t\tCreatedOnId as integer,\n\t\tCancelledById as integer,\n\t\tCancelledOnId as integer,\n\t\tBillDateId as integer,\n\t\tDaysInAdvance as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tDimReservationId = DimReservationID,\n\t\tPOSId = POSID,\n\t\tDimFloorId = DimFloorID,\n\t\tGuestId = GuestID,\n\t\tDimBookerId = DimBookerID,\n\t\tDimMealStructureId,\n\t\tDatetimeID = DateTimeID,\n\t\tPax,\n\t\tVisitsCount,\n\t\tDimEventID,\n\t\tDimFlagId = DimFlagID,\n\t\tActualPax,\n\t\tDimStatusID,\n\t\tResvCancelID,\n\t\tDimReasonID,\n\t\tWalkinID = WalkInID,\n\t\tLastVisitedID = LastVisitedId,\n\t\tDaysNotVisitedID,\n\t\tVisitStatusID,\n\t\tGuestRatingID,\n\t\tReservationHourID,\n\t\tGroupSizeId,\n\t\tNoShowId = NoShowID,\n\t\tBillAmount,\n\t\tCompBillAmount,\n\t\tBillCount,\n\t\tNewCoustomerCount,\n\t\tDimBookingSourceId = DimBookingSourceID,\n\t\tDimBOTBillNoID = DimBOTBillNoId,\n\t\tCreatedById,\n\t\tCreatedOnId,\n\t\tCancelledById,\n\t\tCancelledOnId = CancelledDateId,\n\t\tBillDateId,\n\t\tDaysInAdvance\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> FactReservation"
		}
	}
}