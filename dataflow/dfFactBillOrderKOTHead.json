{
	"name": "dfFactBillOrderKOTHead",
	"properties": {
		"folder": {
			"name": "POS Transaction"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "dsdwsourcedb",
						"type": "DatasetReference"
					},
					"name": "dfFactBillOrderKOTHead"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "FactBillOrderKOTHead",
						"type": "DatasetReference"
					},
					"name": "FactBillOrderKOTHead"
				}
			],
			"transformations": [],
			"script": "source(output(\n\t\tBillOrderKOTHeadID as integer,\n\t\tPOSID as integer,\n\t\tPropertyID as integer,\n\t\tRegionID as integer,\n\t\tBrandID as integer,\n\t\tCountryID as integer,\n\t\tBillDateID as integer,\n\t\tSettleDateID as integer,\n\t\tBillNo as string,\n\t\tBillAmount as decimal(38,8),\n\t\tBillTime as string,\n\t\tSettleTime as string,\n\t\tPax as integer,\n\t\tTableID as integer,\n\t\tKOTTypeID as integer,\n\t\tEmployeeID as integer,\n\t\tDessertsItemSold as boolean,\n\t\tTeaItemSold as boolean,\n\t\tDimsumItemSold as boolean,\n\t\tTotalTax as decimal(38,8),\n\t\tTotalDiscount as decimal(38,8),\n\t\tRoundOffAmount as decimal(38,8),\n\t\tComplimentory as decimal(38,8),\n\t\tTotalTipAmount as decimal(38,8),\n\t\tGroupSizeID as integer,\n\t\tCashID as integer,\n\t\tCreditCardID as integer,\n\t\tComplimentID as integer,\n\t\tNetAmount as decimal(38,8),\n\t\tSettlementHourID as integer,\n\t\tAvgPerCover as decimal(38,8),\n\t\tAvgPerCover01 as decimal(38,8),\n\t\tTableTurnAroundDuration as double,\n\t\tBillMadeSettleDuration as double,\n\t\tBillID as integer,\n\t\tMealID as integer,\n\t\tDimStyleofOperationID as integer,\n\t\tDimDiscCardID as integer,\n\t\tNCType as integer,\n\t\tWaiterId as integer,\n\t\tCompanyId as integer,\n\t\tBillMade_POSShiftId as integer,\n\t\tDimBillNoId as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT    ISNULL(t1.BillOrderKOTHeadID, 0) AS BillOrderKOTHeadID\\n, ISNULL(t2.POSID, 0) AS POSID\\n, ISNULL(t3.PropertyID, 0) AS PropertyID\\n, ISNULL(t4.RegionID, 0) AS RegionID\\n, ISNULL(t5.BrandID, 0) AS BrandID\\n, ISNULL(t6.CountryID, 0) AS CountryID\\n, ISNULL(t7.DateTimeID, 0) AS BillDateID\\n, ISNULL(t8.DateTimeID, 0) AS SettleDateID\\n, t1.BillNo\\n, ISNULL(t1.BillAmount, 0) AS BillAmount\\n, t1.BillTime\\n, t1.SettleTime\\n, ISNULL(t1.Pax, 0) AS Pax\\n, ISNULL(t9.TableID, 0) AS TableID\\n, ISNULL(t10.KOTTypeID, 0)  AS KOTTypeID\\n, ISNULL(t11.EmployeeID, 0) AS EmployeeID\\n, ISNULL(t12.DessertsItemSold, 0) AS DessertsItemSold\\n, ISNULL(t12.TeaItemSold, 0) AS TeaItemSold\\n, ISNULL(t12.DimsumItemSold, 0) AS DimsumItemSold\\n, ISNULL(t1.TotalTax, 0) AS TotalTax\\n, ISNULL(t1.TotalDiscount, 0) AS TotalDiscount\\n, ISNULL(t1.RoundOffAmount, 0) AS RoundOffAmount\\n, ISNULL(t1.Complimentory, 0) AS Complimentory\\n, ISNULL(t1.TotalTipAmount, 0) AS TotalTipAmount\\n, CASE\tWHEN t1.Pax >= 1 AND  t1.Pax <= 2 THEN 1 \\n\t\tWHEN t1.Pax >= 3 AND t1.Pax <= 4 THEN 2 \\n\t\tWHEN t1.Pax >= 5 AND t1.Pax <= 9 THEN 3 \\n\t\tWHEN t1.Pax >= 10 AND t1.Pax <= 100 THEN 4 ELSE 0 END AS GroupSizeID\\n, ISNULL(t13.CashID, 0) AS CashID\\n, ISNULL(t14.CreditCardID, 0) AS CreditCardID\\n, CASE WHEN t1.PayCompliment = 1 THEN 1 ELSE 0 END AS ComplimentID\\n, t1.BillAmount + t1.RoundOffAmount - t1.TotalTax AS NetAmount\\n, DATEPART(HH,ISNULL(t1.SettleTime, N\\'12:00:00\\')) + 1 AS SettlementHourID\\n, CASE WHEN t1.pax IS NULL OR t1.pax = 0 THEN (t1.BillAmount + t1.RoundOffAmount - t1.TotalTax) \\n\t\tELSE (t1.BillAmount + t1.RoundOffAmount - t1.TotalTax) / t1.Pax END AS AvgPerCover\\n, CASE WHEN t1.Pax IS NULL OR t1.pax = 0 THEN (t1.BillAmount + t1.RoundOffAmount - t1.TotalTax) \\n\t\tELSE (t1.BillAmount + t1.RoundOffAmount - t1.TotalTax) / t1.Pax END AS AvgPerCover01\\n, CASE WHEN Year(MinKotDateTime) > 1900 AND year(T1.BillSettleDateTime) > 1900 \\n\t\tTHEN CAST(T1.BillSettleDateTime - MinKotDateTime AS float) * 1440 \\n\t\tELSE 0 END AS TableTurnAroundDuration\\n, CASE WHEN Year(T1.BillMadeDateTime) > 1900 AND year(T1.BillSettleDateTime)> 1900 \\n\t\tTHEN CAST(T1.BillSettleDateTime - T1.BillMadeDateTime AS float) * 1440 \\n\t\tELSE 0 END AS BillMadeSettleDuration\\n, ISNULL(t15.KotOrderID, 0) AS BillID\\n, t1.BillSettledShift AS MealID\\n, ISNULL(t16.DimStyleofOperationID, 0) AS DimStyleofOperationID \\n, IsNull(T17.DimDiscCardID,0) AS DimDiscCardID\\n, ISNull(NCType,0) as NCType\\n, IsNull(T18.WaiterId,0) AS WaiterId\\n, IsNull(T19.CompanyId,0) AS CompanyId\\n, ISNULL(T1.BillMadeShift,0) as BillMade_POSShiftId\\n, ISNULL(T22.DimBillNoId,0) as DimBillNoId\\nFROM dbo.DimBillOrderKOTHead AS t1 WITH (nolock) LEFT OUTER JOIN\\n\tdbo.DimPosMst AS t2 WITH (nolock) ON t1.POSCode = t2.POSCode LEFT OUTER JOIN\\n\tdbo.DimPropertyMst AS t3 WITH (nolock) ON t1.PropertyCode = t3.PropertyCode LEFT OUTER JOIN\\n\tdbo.DimRegionMst AS t4 WITH (nolock) ON t1.RegionCode = t4.RegionCode LEFT OUTER JOIN\\n\tdbo.DimBrandMst AS t5 WITH (nolock) ON t1.BrandCode = t5.BrandCode LEFT OUTER JOIN\\n\tdbo.DimCountryMst AS t6 WITH (nolock) ON t1.CountryCode = t6.CountryCode LEFT OUTER JOIN\\n\tdbo.DimDateTime AS t7 WITH (nolock) ON Cast(t1.BillDateTime as Date) = t7.CDate LEFT OUTER JOIN\\n\tdbo.DimDateTime AS t8 WITH (nolock) ON t1.SettleDate = t8.CDate LEFT OUTER JOIN\\n\tdbo.DimTableMst AS t9 WITH (nolock) ON t1.TableRoomCode = t9.TableCode LEFT OUTER JOIN\\n\tdbo.DimKOTTypes AS t10 WITH (nolock) ON t1.KOTType = t10.KOTTypeCode LEFT OUTER JOIN\\n\tdbo.DimEmployeeMst AS t11 WITH (nolock) ON t1.EmployeeCode = t11.EmployeeCode LEFT OUTER JOIN\\n\tdbo.DimBillOrderOthers AS t12 WITH (nolock) ON t1.POSCode = t12.POSCode AND t1.BillNo = t12.BillNo LEFT OUTER JOIN\\n\tdbo.DimCash AS t13 WITH (nolock) ON t1.PayCash = t13.CashCode LEFT OUTER JOIN\\n\tdbo.DimCreditCard AS t14 WITH (nolock) ON t1.PayCreditCard = t14.CreditCardCode LEFT OUTER JOIN\\n\tdbo.DimKOTORder AS t15 WITH (nolock) ON t1.POSCode = t15.PosCode AND t1.BillNo = t15.KOTNo LEFT OUTER JOIN\\n\tdbo.DimStyleOfOperation AS t16 WITH (nolock) ON t1.OrderFrom = t16.OrderFrom  LEFT OUTER JOIN\\n\tdbo.DimDiscCardMst t17 with(nolock) on t1.DiscCardCode = t17.DiscCardCode and t1.DiscCardDetailsCode = t17.DiscCardDetailsCode LEFT OUTER JOIN\\n\tdbo.DimWaiterMst T18 on T1.WaiterCode = T18.EmployeeCode and T1.PosCode = T18.PosCode LEFT OUTER JOIN\\n\tdbo.DimCompanyMst T19 on T1.PartyCode = T19.CompanyCode LEFT OUTER JOIN\\n\tdbo.DimBillOrderLink T21 on t1.BillNo = T21.KOTNo and t1.POSCode = T21.POSCode and T21.ParentBillNo <> \\'0\\' LEFT OUTER JOIN\\n\tdbo.DimBillNo T22 on T21.BillNo = T22.BillNo and t21.POSCode = T22.POSCode and T22.ParentBillNo <>\\'0\\'',\n\tformat: 'query') ~> dfFactBillOrderKOTHead\ndfFactBillOrderKOTHead sink(input(\n\t\tFactBOKOTHID as integer,\n\t\tBillOrderKOTHeadID as integer,\n\t\tPOSID as integer,\n\t\tPropertyID as integer,\n\t\tRegionID as integer,\n\t\tBrandID as integer,\n\t\tCountryID as integer,\n\t\tBillDateID as integer,\n\t\tSettleDateID as integer,\n\t\tGroupSizeID as integer,\n\t\tBillNo as string,\n\t\tBillAmount as decimal(38,8),\n\t\tBillTime as string,\n\t\tSettleTime as string,\n\t\tPax as integer,\n\t\tTableID as integer,\n\t\tKOTTypeID as integer,\n\t\tDessertsItemSold as boolean,\n\t\tTeaItemSold as boolean,\n\t\tDimsumItemSold as boolean,\n\t\tEmployeeID as integer,\n\t\tTotalTax as decimal(38,8),\n\t\tTotalDiscount as decimal(38,8),\n\t\tRoundOffAmount as decimal(38,8),\n\t\tComplimentory as decimal(38,8),\n\t\tComplimentoryType as integer,\n\t\tTotalTipAmount as decimal(38,8),\n\t\tCashID as integer,\n\t\tCreditCardID as integer,\n\t\tTableTurnAroundDuration as integer,\n\t\tBillMadeSettleDuration as integer,\n\t\tPayCompliment as integer,\n\t\tComplimentID as integer,\n\t\tSettlementHourID as integer,\n\t\tBillID as integer,\n\t\tMealId as integer,\n\t\tPosRegionID as integer,\n\t\tDimStyleofOperationID as integer,\n\t\tDimDiscCardID as integer,\n\t\tNCType as integer,\n\t\tWaiterId as integer,\n\t\tCompanyId as integer,\n\t\tBillMade_POSShiftId as integer,\n\t\tDimBillNoId as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tmapColumn(\n\t\tBillOrderKOTHeadID,\n\t\tPOSID,\n\t\tPropertyID,\n\t\tRegionID,\n\t\tBrandID,\n\t\tCountryID,\n\t\tBillDateID,\n\t\tSettleDateID,\n\t\tGroupSizeID,\n\t\tBillNo,\n\t\tBillAmount,\n\t\tBillTime,\n\t\tSettleTime,\n\t\tPax,\n\t\tTableID,\n\t\tKOTTypeID,\n\t\tDessertsItemSold,\n\t\tTeaItemSold,\n\t\tDimsumItemSold,\n\t\tEmployeeID,\n\t\tTotalTax,\n\t\tTotalDiscount,\n\t\tRoundOffAmount,\n\t\tComplimentory,\n\t\tTotalTipAmount,\n\t\tCashID,\n\t\tCreditCardID,\n\t\tTableTurnAroundDuration,\n\t\tBillMadeSettleDuration,\n\t\tComplimentID,\n\t\tSettlementHourID,\n\t\tBillID,\n\t\tMealId = MealID,\n\t\tDimStyleofOperationID,\n\t\tDimDiscCardID,\n\t\tNCType,\n\t\tWaiterId,\n\t\tCompanyId,\n\t\tBillMade_POSShiftId,\n\t\tDimBillNoId\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> FactBillOrderKOTHead"
		}
	}
}